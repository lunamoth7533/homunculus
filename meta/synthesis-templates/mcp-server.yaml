---
id: mcp-server-template
version: 3
output_type: mcp_server
# Legacy single-file path (kept for backward compatibility)
output_path: "evolved/mcp-servers/{slug}/README.md"
applicable_gap_types:
  - tool
  - integration

# Multi-file output: generates package.json, index.ts, and README.md
output_files:
  - path: "evolved/mcp-servers/{slug}/package.json"
    action: create
    content: |
      {{
        "name": "{slug}-mcp-server",
        "version": "1.0.0",
        "description": "{desired_capability}",
        "type": "module",
        "main": "index.ts",
        "scripts": {{
          "start": "npx tsx index.ts",
          "build": "tsc",
          "typecheck": "tsc --noEmit"
        }},
        "dependencies": {{
          "@modelcontextprotocol/sdk": "^1.0.0"
        }},
        "devDependencies": {{
          "tsx": "^4.0.0",
          "typescript": "^5.0.0",
          "@types/node": "^20.0.0"
        }},
        "evolved_from": {{
          "gap_id": "{gap_id}",
          "gap_type": "{gap_type}",
          "created": "{timestamp}"
        }}
      }}

  - path: "evolved/mcp-servers/{slug}/index.ts"
    action: create
    content: |
      /**
       * {title} MCP Server
       *
       * Generated by Homunculus on {timestamp}
       * Gap ID: {gap_id}
       * Domain: {domain}
       */
      import {{ Server }} from "@modelcontextprotocol/sdk/server/index.js";
      import {{ StdioServerTransport }} from "@modelcontextprotocol/sdk/server/stdio.js";
      import {{
        CallToolRequestSchema,
        ListToolsRequestSchema,
      }} from "@modelcontextprotocol/sdk/types.js";

      const server = new Server(
        {{ name: "{slug}", version: "1.0.0" }},
        {{ capabilities: {{ tools: {{}} }} }}
      );

      // Define available tools
      server.setRequestHandler(ListToolsRequestSchema, async () => ({{
        tools: [
          {{
            name: "{slug}_action",
            description: "{desired_capability}",
            inputSchema: {{
              type: "object",
              properties: {{
                input: {{
                  type: "string",
                  description: "Input for the {domain} operation"
                }}
              }},
              required: ["input"]
            }}
          }}
        ]
      }}));

      // Handle tool calls
      server.setRequestHandler(CallToolRequestSchema, async (request) => {{
        const {{ name, arguments: args }} = request.params;

        if (name === "{slug}_action") {{
          // TODO: Implement the actual functionality for: {desired_capability}
          const input = (args?.input as string) || "";

          try {{
            // Placeholder implementation
            const result = `Processed: ${{input}}`;

            return {{
              content: [{{ type: "text", text: result }}]
            }};
          }} catch (error) {{
            return {{
              content: [{{ type: "text", text: `Error: ${{error}}` }}],
              isError: true
            }};
          }}
        }}

        return {{
          content: [{{ type: "text", text: `Unknown tool: ${{name}}` }}],
          isError: true
        }};
      }});

      // Start the server
      const transport = new StdioServerTransport();
      server.connect(transport);
      console.error("{slug} MCP server started");

  - path: "evolved/mcp-servers/{slug}/README.md"
    action: create
    content: |
      # {title} MCP Server

      > Generated by Homunculus on {timestamp}

      ## Purpose

      {desired_capability}

      ## Quick Setup

      1. Install dependencies:

      ```bash
      cd ~/homunculus/evolved/mcp-servers/{slug}
      npm install
      ```

      2. Test the server:

      ```bash
      npm start
      ```

      ## Configure Claude Code

      Add to `~/.claude/settings.json`:

      ```json
      {{
        "mcpServers": {{
          "{slug}": {{
            "command": "npx",
            "args": ["tsx", "${{HOME}}/homunculus/evolved/mcp-servers/{slug}/index.ts"]
          }}
        }}
      }}
      ```

      ## Evolved From

      - **Gap ID**: {gap_id}
      - **Gap Type**: {gap_type}
      - **Domain**: {domain}
      - **Confidence**: {confidence}
      - **Scope**: {recommended_scope}

      ## Evidence

      {evidence_summary}

      ## TODO

      - [ ] Implement actual tool functionality in `index.ts`
      - [ ] Add input validation
      - [ ] Add error handling for edge cases
      - [ ] Add additional tools if needed

synthesis_prompt: |
  Generate a minimal MCP server for:

  Gap Type: {gap_type}
  Domain: {domain}
  Desired Capability: {desired_capability}
  Evidence: {evidence_summary}

  Create an MCP server that:
  1. Uses @modelcontextprotocol/sdk
  2. Implements only the tools needed to fill the gap
  3. Includes proper error handling
  4. Works without external API keys (or documents required config)
  5. Has clear TODO markers for functionality to implement
